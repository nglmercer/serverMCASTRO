---
import type { Server } from 'src/types/server';
import StatusIndicator from './StatusIndicator.astro';
import CPopup from '../solid/solid.tsx';
interface Props {
  server: Server;
}

const { server } = Astro.props;
---

<div class="server-card">
  <div class="p-10 m-auto">
    <server-item
    data-server="server-01"
    data-size="1048576"
    data-version="1.2.3"
    data-modified="2023-05-15"
    data-status="active"
    icon="/favicon.svg"
    title="Production Server">
    <!-- Contenido personalizado para el slot -->
     <div class="flex center">
       <StatusIndicator status="stopped" />
       <button class="more-options">
         <span class="material-symbols-rounded">more_vert</span>
       </button>
     </div>
    </server-item>
  </div>
  

</div>
<CPopup id="serverOptions" class="serverModal_0 material-symbols-rounded server-card" client:load />

<script>
  import { type EDetails } from 'src/litcomponents/mc/serveritem.js';
  interface OptionModal {
      icon: string;
      text: string;
      id?:string;
      class?: {
          font?: string;
          container?: string;
      };
  }

  const optionsModal = (option: OptionModal) => {
      return /*html*/ `
  <div class="${option.class?.container || 'dropdown-item'}" ${option.id ? `id="${option.id}"` : ''}>
    <span class="material-symbols-rounded">${option.icon}</span>
    <span class="${option.class?.font || 'default-font'}">${option.text}</span>
  </div>`;
  };

  const popup = document.getElementById('serverOptions');
  document.querySelectorAll('server-item').forEach(element => {
      element.addEventListener('selected', function(e) {
        if (!('detail' in e)) return;
        console.log("selected", e.detail);
      });

      element.addEventListener('menu', function(e) {
        if (!('detail' in e)) return;
        const detail = (e as CustomEvent).detail as EDetails;
        console.log("menu", detail);
        
        // Initialize popup with options
        if (popup && 'setOptions' in popup) {
          // Use the component methods directly
          (popup as any).setOptions(getOptions());
          (popup as any).show(detail.event);
        } else {
          // Fallback to window.solidComponents
          const solidPopup = (window as any).solidComponents?.serverOptions;
          if (solidPopup) {
            solidPopup.setOptions(getOptions());
            solidPopup.show(detail.event);
          }
        }
      });
    });
  
  function getOptions() {
    const options = [
      {
        html: optionsModal({id:"create-backup",icon:"backup",text:"Create Backup"}),
        callback: function() {
          console.log("Option 1 clicked");
        }
      },
      {
        html: optionsModal({id:"restore-backup",icon:"restore",text:"Restore Backup"}),
        callback: function() {
          console.log("Option 2 clicked");
        }
      },
      {
        html: optionsModal({id:"delete-server",icon:"delete",text:"Delete Server"}),
        callback: function() {
          console.log("Option 3 clicked");
        }
      },
      {
        html: optionsModal({id:"download-server",icon:"download",text:"Download Server"}),
        callback: function() {
          console.log("Option 4 clicked");
        }
      },
    ]
    return options;
  }
  document.addEventListener('DOMContentLoaded', function() {
  });
</script>
<style>
  .server-card {
    background-color: var(--color-dark-900);
    border: 1px solid var(--color-gray-800);
    border-radius: var(--border-radius-xl);
    overflow: hidden;
    margin-bottom: var(--space-6);
  }
  
  .server-info {
    display: flex;
    align-items: center;
    gap: var(--space-3);
  }
  
  .server-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: var(--color-dark-800);
    padding: var(--space-2);
    border-radius: var(--border-radius-lg);
  }
  
  .server-icon span {
    font-size: 2rem;
    color: var(--color-primary-500);
  }
  
  .server-title h3 {
    font-size: var(--font-size-lg);
    font-weight: 600;
  }
  
  .server-type {
    font-size: var(--font-size-sm);
    color: var(--color-gray-400);
  }
  
  .server-actions {
    display: flex;
    align-items: center;
    gap: var(--space-4);
  }
  
  .more-options {
    color: var(--color-gray-400);
    transition: color 0.2s ease;
  }
  
  .more-options:hover {
    color: var(--color-white);
  }
  
  .server-details {
    background-color: var(--color-dark-800);
    border-radius: var(--border-radius-lg);
    margin: 0 var(--space-6) var(--space-6);
    padding: var(--space-4);
  }
  
  .server-metrics {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: var(--space-4);
    margin-bottom: var(--space-4);
  }
  
  @media (min-width: 768px) {
    .server-metrics {
      grid-template-columns: repeat(4, 1fr);
    }
  }
  
  .metric-label {
    font-size: var(--font-size-sm);
    color: var(--color-gray-400);
    margin-bottom: var(--space-1);
  }
  
  .metric-value {
    font-weight: 600;
  }
  
  .metric-value.ping {
    color: var(--color-green-500);
  }
</style>